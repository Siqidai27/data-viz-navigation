<html>
	<head>
		<meta charset="utf-8">
		<title>Navigation system using d3</title>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation-icons/3.0/foundation-icons.min.css">
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="http://d3js.org/topojson.v2.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script> -->
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script> -->
		<script src="fisheye.js"></script>
	</head>
	<style>
		.roads {<html>
			<head>
				<meta charset="utf-8">
				<title>Navigation system using d3</title>
				<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
				<link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation-icons/3.0/foundation-icons.min.css">
				<script src="https://d3js.org/d3.v4.min.js"></script>
				<script src="http://d3js.org/topojson.v2.min.js"></script>
				<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
				<script src="fisheye.js"></script>
			</head>
			<style>

				.roads {
				  	fill: none;
				  	stroke-linejoin: round;
				  	stroke-linecap: round;
				}

				.major-highway { stroke: #525252; stroke-width: .5px; }
				.secondary-highway { stroke: #737373; stroke-width: .5px;}
				.road { stroke: #bdbdbd; stroke-width: .5px;}
				.beltway { stroke: #737373; stroke-width: .5px;}
				.ferry-route { stroke: #4393c3; stroke-width: .5px; }
			</style>
			<body>
				<div class="heading">
					<h1> <div class="yellow">Navigation</div> </h1>
					<div class="intro">
						<h3 class="yellow">Introduction</h3>
						<p>
							<a href=>[ fact check! ]</a>. This webpage illuminates these economic changes through visual representations.</p>
						<i class="fi-arrow-down small"></i>
					</div>

				</div>

			<script>
			var width = 960,height = 600;

			var svg = d3.select("body").append("svg")
			    .attr("width", width)
			    .attr("height", height);
			var transform = d3.zoomIdentity;

			var projection = d3.geoAlbersUsa()
				.scale(1100)
				.translate([width / 2, height / 2]);
			var rawData


			d3.json("data/usroads.json", function(error, usroads) {
			  	if (error) throw error;
				rawData = usroads;
				showMap();
			})

			function showMap(){
				var path = d3.geoPath()
				    .projection(projection);
				var path2 = d3.geoPath();


				svg.call(d3.zoom()
			    .scaleExtent([1/2, 16])
			    .on("zoom", zoomed));

				function zoomed() { g.attr("transform", d3.event.transform); }

				function dragged(d) { d3.select(this).attr("cx", d.x = d3.event.x).attr("cy", d.y = d3.event.y); }

				var g = svg.append("g");

				var usa = g.append("g")
				.selectAll("path")
				    .data(topojson.feature(rawData, rawData.objects.usa).features)
				.enter().append("path")
				    .attr("d", path)
				 	.style("fill","none")
				  	.style("stroke","#252525")
				  	.style("stroke-width",1);

				var roads = g.append("g")
				.selectAll("path")
				 	.data(topojson.feature(rawData, rawData.objects.roads).features)
				.enter().append("path")
		      		.attr("d", path)
				    .attr("class",function(d) { return "roads " + d.properties.type.toLowerCase().split(' ').join('-'); });

				var data = topojson.feature(rawData, rawData.objects.roads).features;

				var startN = [];
				data.forEach(function(d){
					if (d.geometry.type == "LineString"){
						startN.push(d.geometry.coordinates[0])
					}
					if (d.geometry.type == "MultiLineString"){
						for (i=0; i<d.geometry.coordinates.length; i++){
							startN.push(d.geometry.coordinates[i][0])
						}
					}
				})
				// console.log(startN)

				var nodes = [];
				var dist = 0;
				data.forEach(function(d){
					var node = [];
					if (d.geometry.type == "LineString"){
						node.push(d.geometry.coordinates[0])
						for (j=0; j<d.geometry.coordinates.length-1; j++) {
							var s0 = d.geometry.coordinates[j]
							var s1 = d.geometry.coordinates[j+1]
							dist += Math.sqrt((s1[0]-s0[0])*(s1[0]-s0[0]) + (s1[1]-s0[1])*(s1[1]-s0[1]))
						}
						node.push(dist)
						node.push(d.geometry.coordinates[d.geometry.coordinates.length-1])
					}
					if (d.geometry.type == "MultiLineString"){
						for (i=0; i<d.geometry.coordinates.length; i++) {
							node.push(d.geometry.coordinates[i][0])
						}
					}
					nodes.push(node)
				})
				// console.log(nodes)

				var circles = g.append("g").selectAll("circle").data(startN);
				circles.exit().remove();
				circles.enter().append("circle")
				.attr("r", 0.5)
				.merge(circles)
				.attr("cx", function(d) {
					if (projection(d)!=null){
						// console.log(projection(d)[0])
						return projection(d)[0];
					}
				})
				.attr("cy", function(d) {
					if (projection(d)!=null){
						return projection(d)[1];
					}
				})
				.style("fill", "red");

				var fisheye = d3.fisheye.circular()
					.radius(200)
					.distortion(2);

				svg.on("mousemove", function() {
					// var center = d3.mouse(this);
					// fisheye.focus(projection.invert([center[0],center[1]]));
					fisheye.focus(d3.mouse(this));
					var paths = d3.selectAll("path")

					paths.attr("transform", function(d) {
						var b = d.geometry.coordinates;
						// console.log(b)
						var c = b.map(function(e){
							var f = {x:e[0], y:e[1]};
							return fisheye(f);
						})
						var g=[]
						for (i=0; i<c.length; i++) {
							g.push(([c[i].x, c[i].y]))

						}
						var p = {type: d.geometry.type, coordinates: g}
						console.log(path(p))
						// return path(p)
				    })

					// circles.enter()
					// .attr("cx", function(d){
					// 	d.fisheye = d.geometry.coordinates.map(function(e){
					// 		var f = {x:e[0], y:e[1]};
					// 		return fisheye(f);
					// 		return d.fisheye.x})
					// .attr("cy", function(d){return d.fisheye.y})
					// .attr("r", function(d){return d.fisheye.z*0.5})


				});

			}

			</script>


			</body>
		</html>

		  fill: none;
		  stroke-linejoin: round;
		  stroke-linecap: round;
		}

		.major-highway { stroke: #525252; stroke-width: 1.5px; }
		.secondary-highway { stroke: #737373; }
		.road { stroke: #bdbdbd; }
		.beltway { stroke: #737373; }
		.ferry-route { stroke: #4393c3; stroke-width: 1.5px; }
	</style>
	<body>
		<div class="heading">
			<h1> <div class="yellow">Navigation</div> </h1>
			<div class="intro">
				<h3 class="yellow">Introduction</h3>
				<p>
					<a href=>[ fact check! ]</a>. This webpage illuminates these economic changes through visual representations.</p>
				<i class="fi-arrow-down small"></i>
				<i>üìç</i>
			</div>

		</div>

	<script>
	var width = 960,height = 600;

	var svg = d3.select("body").append("svg")
	    .attr("width", width)
	    .attr("height", height);

	var projection = d3.geoAlbersUsa()
		.scale(1100)
		.translate([width / 2, height / 2]);
	var rawData


	d3.json("data/usroads.json", function(error, usroads) {
	  	if (error) throw error;
		rawData = usroads;
		showMap();
	})

	function showMap(){
		var path = d3.geoPath()
		    .projection(projection);

		var nodes = [];
		for (var i=0; i<rawData.arcs.length; i++) {
			nodes.push(rawData.arcs[i][0]);
		}

	  	svg.append("g")
		.selectAll("path")
		    .data(topojson.feature(rawData, rawData.objects.usa).features)
		.enter().append("path")
		    .attr("d", path)
		 	.style("fill","none")
		  	.style("stroke","#252525")
		  	.style("stroke-width",1);

	  	svg.append("g")
		.selectAll("path")
		 	.data(topojson.feature(rawData, rawData.objects.roads).features)
		.enter().append("path")
      		.attr("d", path)
		    .attr("class",function(d) { return "roads " + d.properties.type.toLowerCase().split(' ').join('-'); });

		var cities = [[-76.4969434, 42.44057355]]

		var circles = svg.selectAll("circle").data(cities);
		circles.exit().remove();
		circles.enter().append("circle")
		.attr("r", 2)
		.merge(circles)
		.attr("cx", function(d) { return projection(d)[0]; })
		.attr("cy", function(d) { return projection(d)[1]; })
		.style("fill", "red");

		var fisheye = d3.fisheye.circular()
			.radius(200)
			.distortion(2);
		fisheye.focus([-76.4969434, 42.44057355]);
		console.log(fisheye(cities));

		svg.on("mousemove", function() {
			// var center = d3.mouse(this);
			// fisheye.focus(projection.invert([center[0],center[1]]));
			fisheye.focus(d3.mouse(this));
			var paths = d3.selectAll("path")
			paths.attr("d", function(d) {
				var b = d.geometry.coordinates;
				// console.log(b)
				var c = b.map(function(e){ console.log(e.fisheye); return fisheye(e)})
				// console.log(c)
				var d = {type: d.geometry.type, coordinates: b}
				// console.log(d)
				return path(d)

			});


			//
			// //
			// paths.attr("d",null)
			// .attr("d", function(d) {
			//     if (d.geometry.type === "Linestring") {
			//         var b = d.geometry.coordinates.map(function(d) { return d.map(function(f) { return fisheye(f);}); });
			//     }
			//     else {
			//         var b = d.geometry.coordinates.map(function(d) { return d.map(function(f) { return f.map(function(g) { return fisheye(g); }); }); });
			//     }
			//     var c = {type: d.geometry.type, coordinates: b};
			//     return path(c);
			// });
		});

	}


	// d3.select(self.frameElement).style("height", height + "px");

	// var svg2 = d3.select("body").append("svg")
	// .attr("width", width)
	// .attr("height", height);
	// var newData;
	// d3.json("data/new_ne_10m_roads.geojson", function(error, data) {
	//   	if (error) throw error;
	// 	newData = data;
	// 	var projection = d3.geoAlbersUsa();
	//
	// 	var path = d3.geoPath().projection(projection);
	//
	// 	svg.append("g")
	// 	.selectAll("path")
	// 		.data(topojson.feature(newData, newData.objects.roads).features)
	// 	.enter().append("path")
	// 		.attr("d", path)
	// 		.attr("class",function(d) { return "roads " + d.properties.type.toLowerCase().split(' ').join('-'); });
	//
	// })


	</script>


	</body>
</html>
