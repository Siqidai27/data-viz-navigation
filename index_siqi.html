<html>
	<head>
		<meta charset="utf-8">
		<title>Navigation system using d3</title>
		<!-- <link href="https://fonts.googleapis.com/css?family=Alegreya|Alegreya+Sans" rel="stylesheet"> -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation-icons/3.0/foundation-icons.min.css">
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="http://d3js.org/topojson.v2.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script> -->
		<!-- <script src="fisheye.js"></script> -->
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	</head>
	<style>
		.roads {
		  fill: none;
		  stroke-linejoin: round;
		  stroke-linecap: round;
		}

		.major-highway { stroke: #525252; stroke-width: 1.5px; }
		.secondary-highway { stroke: #737373; }
		.road { stroke: #bdbdbd; }
		.beltway { stroke: #737373; }
		.ferry-route { stroke: #4393c3; stroke-width: 1.5px; }
		/*circle.startPoint { fill: "red"; }*/

	</style>

	<body>
		<h1> <div class="yellow">Navigation</div> </h1>

		<div id="header">
			<input name="StartingPoint"  type="text" id="start" placeholder="Starting point&hellip;" >
			<input name="Destination" type="text" id="destination" placeholder="Destination&hellip;">
			<button id="search">Find Cities!</button>
			<div>
				<div>Start from: <span id="startFrom"></span> ; </div>
				<div>Go to: <span id="goTo"></span></div>
			</div>
		</div>
		<div id="plot">
			<circle id="startPoint" />
		</div>



	<script>
		var width = 960,
	    	height = 600;

		var projection = d3.geoAlbersUsa()
		    .scale(1100)
		    .translate([width / 2, height / 2]);

		var path = d3.geoPath()
		    .projection(projection);

		var svg = d3.select("#plot").append("svg")
		    .attr("width", width)
		    .attr("height", height);

		var rawData

		d3.json("data/usroads.json", function(error, usroads) {
			if (error) throw error;

			// console.log(topojson.feature(usroads, usroads.objects.roads).features);

			//boundary
	  	svg.append("g")
			.selectAll("path")
		  .data(topojson.feature(usroads, usroads.objects.usa).features)
			.enter().append("path")
		  .attr("d", path)
		 	.style("fill","none")
			.style("stroke","#252525")
		  .style("stroke-width",1);

	  	svg.append("g")
			.selectAll("path")
		 	.data(topojson.feature(usroads, usroads.objects.roads).features)
			.enter().append("path")
      .attr("d", path)
		  .attr("class",function(d) { return "roads " + d.properties.type.toLowerCase().split(' ').join('-'); });


			showCities();
			console.log("showCities");
		});

		var citiesData;
		var citiesLocation = [];
		var startPoint;
		var destinationPoint;
		function parseCities (line) {
			line.lng = Number(line.lng);
			line.lat = Number(line.lat);
			return line;
		}
		d3.csv("data/uscities.csv", parseCities,function(error, data) {
			citiesData = data;
		});

		function showCities(){

			citiesData.forEach(function(d) {
				citiesLocation.push({"city": d.city, "location": [d.lng,d.lat], "province": d.province});
			});

			var circles = svg.selectAll("circle").data(citiesLocation).enter()
			.append("circle")
			.attr("cx", function (d) { return projection(d.location)[0]; })
			.attr("cy", function (d) { return projection(d.location)[1]; })
			.attr("r", 2)
			.style("fill","#429EFF");

			console.log("showCircles");
			startPoint = svg.append("circle")
			.attr("cx", 1)
			.attr("cy", 1)
			.attr("r", 3)
			.style("fill","white");
			destinationPoint = svg.append("circle").attr("id","destinationPoint")
			.attr("cx", 1)
			.attr("cy", 1)
			.attr("r", 3)
			.style("fill","white");

		}



	</script>

	<script>
		// init();
		d3.select("#search").on("click", work);

		function work(){
			var string_start = d3.select("#start").property("value");
			var string_destination = d3.select("#destination").property("value");
			var start = -1;
			var destination = -1;
			// console.log(citiesLocation);
			citiesLocation.map(function (data,i) {
  			if (data.city == string_start) {
    			start = i;
  			}
				if (data.city == string_destination) {
    			destination = i;
  			}
			});

			drawCities(start,destination);
		}



		function drawCities(start,destination){
			if(start == -1 || destination == -1){
				console.log("enter the name of city!");
				return false;
			}

			startPoint.transition().duration(1000).delay(500)
			.attr("cx", function (d) { return projection(citiesLocation[start].location)[0]; })
			.attr("cy", function (d) { return projection(citiesLocation[start].location)[1]; })
			.attr("r", 5)
			.style("fill","red");


			destinationPoint.transition().duration(1000).delay(500)
			.attr("cx", function (d) { return projection(citiesLocation[destination].location)[0]; })
			.attr("cy", function (d) { return projection(citiesLocation[destination].location)[1]; })
			.attr("r", 5)
			.style("fill","blue");
		}
	</script>


	</body>
</html>
